# 调试指南 – Parkinson Tremor/Dyskinesia 检测固件

本指南⽤于帮助测试/调参⼈员快速理解 **Main.cpp** 中暴露的调试开关与阈值， 并在不同情境下排查误报/漏报。

---
## 1. 串⼝输出格式
```
---Win 12---            ← 3 s ⽪窗序号
RAW ax ay az gx gy gz   ← 每 DEBUG_RAW_EVERY 个样本输出一次原始计数
AX 3-5 P35 5-7 P57 rms ← 每轴 FFT 摘要 (可关)
Decision T=1(0.62) D=0(0.00)
```
| 字段 | 含义 | 如何利⽤ |
|------|------|-----------|
| **RAW** | 6 个 int16 原始 LSB | 判断传感器是否活跃/饱和；估算信噪⽐ |
| **P35/P57** | 3‑5 Hz / 5‑7 Hz 区间最⾼幅值 (g 或 dps) | 观测振动主峰强度 |
| **rms** | 0‑7 Hz 带宽均⽅值幅度 | ⽐较噪声底，配合 PEAK_TO_RMS 过滤 |
| **T / D** | 0/1: 有⽆ tremor/dysk；括号内为归⼀化强度 | LED 亮度映射 |

---
## 2. Config Block 说明
| 变量 | 默认 | 功能 | 调整建议 |
|-------|-------|------|-----------|
| `DEBUG_RAW_EVERY` | 50 | RAW 打印间隔 (采样 Tick) | 调试 I²C/尺度时设 1–10；稳定后 0 关闭 |
| `DEBUG_FFT_SUMMARY` | 1 | 打印 FFT 摘要 | 0 可减串⼝流量 |
| `DEBUG_THRESH_MSG` | 1 | 打印决策⽂字 | 发布版可关 |
| `ACC_T_TH / ACC_D_TH` | 0.20 g | 加速度阈值 | 取 **静⽌ RMS × 4–8** |
| `GYR_T_TH / GYR_D_TH` | 30 dps | 陀螺仪阈值 | 取 **静⽌ RMS × 4–8** |
| `PEAK_TO_RMS` | 3.0 | 峰值/均⽅⽐门限 | 2–4；>3 抑制宽带噪声 |

---
## 3. 推荐调试流程
### 3.1 基线测量（静⽌）
1. **放平板⼦，保持静⽌**；设 `DEBUG_FFT_SUMMARY=1`。
2. 记录各轴 `rms`（应 <0.05 g / <5 dps）。
3. 设阈值 = *RMS × 5*，`PEAK_TO_RMS=3`。
4. 确认 `Decision T=0 D=0`，LED 熄灭。

### 3.2 Tremor（3‑5 Hz ⼩幅）
1. **⼿持板⼦，微抖⼿腕**（≈4 Hz，位移 <1 cm）。
2. 观察 `AX/AY/… 3-5` 峰值是否 > 阈值且 `peak/rms>3`。
   * 若 **未触发** → 逐步 *降低* `ACC_T_TH / GYR_T_TH`（每次 -10%）。
   * 若 **误触发** （静⽌也触发）→ *提⾼* 阈值或 `PEAK_TO_RMS`。

### 3.3 Dyskinesia（5‑7 Hz ⼤幅）
1. **做较快的甩⼿动作**（≈6 Hz，位移 >3 cm）。
2. 同上，调 `*_D_TH` 阈值。

### 3.4 分轴排查
若只有单轴峰值显著，说明姿态影响采样：可以只⽤陀螺或加速计，对倾斜较敏感的轴单独调低阈值。

---
## 4. 常见问题
| 现象 | 可能原因 | 处理 |
|------|----------|------|
| `RAW` 恒 0 | I²C NACK / 地址错 / 传感器关⻔ | 检查 `WHO_AM_I` = 0x6A；回读 `CTRL1=0x40` |
| 静⽌也判定 T/D=1 | 阈值过低；`PEAK_TO_RMS` 过⼩ | 增⼤阈值至 **RMS×6**；`PEAK_TO_RMS≥3` |
| ⼩幅抖动无法触发 | 阈值过⾼ / FFT 稀释 | 降阈值 10% 或增 `WIN_S`=4 s 提⾼分辨率 |
| 判定 T
d 都为 1 | 同时 3‑5 与 5‑7 峰值 > 门限 | 根据临床优先级，可在代码中互斥处理 |

---
## 5. LED 逻辑回顾
* **2 Hz 闪烁** → Tremor 优先；**5 Hz 闪烁** → Dyskinesia 优先。
* 占空=强度 (0–1)。透过 LED 明暗即可快速评估调参数结果。

---
> **提示**：完成调参后，把 `DEBUG_*` 设为 0，并将阈值常量写回代码作最终提交。

